= {title-deployment}
include::.variables.adoc[]
:description: {description-deployment}
:vhost-host: xp-admin.com

Working on your local copy is great for development, but you can't expose what you build to someone else that way. For that, you need to deploy XP and your app to somewhere. In this {document}, we'll give a high-level overview of how you do just that.

== Deployment

You have two main choices for deploying XP:

* Run it _as a service_ on the Enonic Cloud
* Self-host it

Enonic recommends using Enonic Cloud for a smoother experience, but you can choose to self-host it yourself if that better suits your requirements.

=== Enonic Cloud

Enonic offers a fully managed way to run XP, known as the Enonic Cloud. As a user of Enonic Cloud, you can sit back and relax and let Enonic take care of all your infrastructure, including monitoring, backups, automation, and more.

This is by far the easiest way to get an XP installation up and running. To learn more about it and get a free trial, head over to https://enonic.com/platform/platform-as-a-service[the Platform as a Service page].

=== Self-hosted

If relying on cloud services isn't for you, you can also self-host the Enonic platform. There's a number of different deployment strategies to choose from, based on what suits your particular situation the best.

To learn more about self-hosting and deployment strategies, check out https://developer.enonic.com/docs/xp/stable/deployment[the _deployment_ section of the XP reference docs].

== Uploading apps

Regardless of how you deploy your XP instance, uploading your XP apps is the same.

To upload an app:

. Log into your XP deployment
. Use the admin menu to navigate to the applications page
. Choose install from the toolbar and upload your application `.jar` file. You can drag and drop your application or navigate the file hierarchy via the upload button.
+
.Drag and drop applications to upload them
image::deployment-app-upload.png["The application installation menu with a blue overlay. The overlay says 'drop files to upload'",{image-xl}]
// TODO: add image here

== Virtual hosts: pretty paths

When accessing XP resources such as the GraphQL API explorer in this tutorial, the URLs have been long and unsightly. When working in production environment, this isn't something you want. Instead, you want short, pretty URLs that are easy to remember. Virtual hosts (_vhosts_) configuration lets you do just that.

Your vhosts file is a configuration file that sits in your XP sandbox's configuration directory. This file contains mappings from public-facing URLs to internal URLs. This lets the user access `{p1-site-slug}.com/api` and retrieve content from `/site/default/master/{p1-site-slug}/api`.

An example vhosts file that achieves the mapping mentioned could contain the following:

[src,properties,{subs}]
----
enabled = true <--.-->

mapping.example.host = {p1-site-slug}.com <--.-->
mapping.example.source = / <--.-->
mapping.example.target = /site/default/master/{p1-site-slug}/
----
<.> Enable vhosts configuration
<.> Intercept requests to `{p1-site-slug}.com`
<.> Map any request that starts with this path ...
<.> ... to the internal URL.

To read more about virtual hosts, head to the https://developer.enonic.com/docs/xp/stable/deployment/vhosts[_Vhosts_ section of the deployment documentation].

=== Task: local vhosts config

To explore how vhosts mappings work, let's configure vhosts for our local XP instance. Then, to test it, we'll configure our local `hosts` file.

. Find and open your sandbox's vhosts file. From your user's home directory, the path will be `.enonic/sandboxes/<sandbox-name>/home/config/com.enonic.xp.web.vhost.cfg`, where `<sandbox-name>` varies depending on which sandbox you want to configure. If it is your first one, it'll be `Sandbox1`.

. Update the vhosts file.
+
[source,config,{subs}]
----
enabled = true

mapping.admin.host = {vhost-host} <--.-->
mapping.admin.source = /
mapping.admin.target = /admin
mapping.admin.idProvider.system = default

mapping.localhost.host = localhost <--.-->
mapping.localhost.source = /
mapping.localhost.target = /
mapping.localhost.idProvider.system = default
----
+
<.> If requests go to `xp-admin.com:8080`, send them to `:8080/admin`
<.> This block allows the localhost mappings to keep working. Without this, `localhost:8080` wouldn't work anymore.
+
. If you're watching your XP process, you should see a message like this:

  2021-06-09 13:49:43,405 INFO  c.e.x.s.i.config.ConfigInstallerImpl - Loaded config for [com.enonic.xp.web.vhost]
  2021-06-09 13:49:43,411 INFO  c.e.x.w.v.i.c.VirtualHostServiceImpl - Virtual host is enabled and mappings updated.
+
This means that XP has updated the mappings and is ready to go.

. To test this out, update your local hosts file (https://en.wikipedia.org/wiki/Hosts_%28file%29[_hosts file_ on Wikipedia]) to point `{vhost-host}` to `127.0.0.1` by adding the following line to the file:
+
[source,conf,{subs}]
----
127.0.0.1 {vhost-host}
----
+
TIP: On Linux and macOS you'll find the hosts file at `/etc/hosts`. On Windows, it's located at  `c:\Windows\System32\Drivers\etc\hosts`

. Now access `http://xp-admin.com:8080` in your browser. If all has gone well, you should see the familiar XP login screen.
+
NOTE: If you're not seeing anything or aren't able to access the resources, that may be due to a browser setting. Try using a different browser and see if that makes a difference.

== What's next?

Congrats! You've reached the end of the introduction for now. This document is still a work in progress and new content will be added at a later date. If you'd like to go further now, why don't you try one of the following guides which introduce extra aspects of the XP experience?

https://developer.enonic.com/guides/headless-cms-intro[Introduction to headless CMS]:: If you've enjoyed the headless aspects of this introduction, why not visit this guide to further your knowledge of how to use the GraphQL API and how to customize it.
https://developer.enonic.com/guides/my-first-site[My first site]:: If you're interested in building a traditional CMS-based application with server rendered pages, this is the guide for you. It covers building pages and using more Content Studio building blocks such as regions, parts, and page templates.
https://developer.enonic.com/guides/my-first-webapp[My first webapp]:: If you're more interested in building web apps than web sites, how about this guide which focuses more on the web app aspects, including JavaScript controllers, serving assets, and routing.
