= {title-iam}
include::.variables.adoc[]
:description: {description-iam}
:host: xp-admin.com

Might want to link to the https://developer.enonic.com/docs/xp/stable/iam[IAM docs]

There's also this article about https://developer.enonic.com/docs/content-studio/stable/permissions[article  about Content Studio permissions]

When you deploy  your XP instance to anywhere outside of your own, local computer, you're most likely going to want to restrict access to parts of it. You very likely aren't going to want to leave your admin pages open to the public, and in many cases you're also going to want to create content that requires a user to log in before accessing it. To facilitate that, XP uses something called identity providers (_ID providers_ for short).

This {document} covers the basics of _Identity and Access Management_ (IAM) in XP. It covers _users_, _groups_, and _roles_, _permissions_, and finally how to set up and configure ID providers in XP.

== Principals: Users, groups, and roles
// This does not need to be a deep dive on these topics, but it should give the reader an overview of what these are and why they exist. Should also mention the granularity with which they can be applied.

https://en.wikipedia.org/wiki/Principal_(computer_security)[According to Wikipedia], A _principal_ is

[quote, Wikipedia: Principal (computer security)]
 [...] an entity that can be authenticated by a computer system or network. [...] Principals can be individual people, computers, services, computational entities such as processes and threads, or any group of such things.

The XP IAM system has three principals: _users_, _groups_, and _roles_.

A _user_ is the most basic kind of principal. As you might expect, they correspond to login credentials and are typically given out to each physical user. A user principal can be a member of any number of groups and be assigned any number of roles.

A _group_ is a collection of users. Each group can contain any number of users. Additionally, a group may be assigned any number of roles. Each member that is part of a group is then also assigned all the roles that a group has.

A _role_ provides application-specific functionality. Each application can bundle a number of roles, each of which gives the assignee permission to perform certain actions related to the application. For instance: the _Administrator_ role comes bundled with XP. Any user with this role (either directly or transitively via their group) gets full access to all content and admin tools in XP.

== Permissions

Permissions tell the system what actions a user, group, or role can perform. That is: permissions grant authorization to perform certain actions. Use them to give fine-grained access to items in the NoSQL storage .

.Questions
- What items are in NoSQL storage? Should it be NoQL storage?
- What sort of items have permissions and what sort of items do not?

For instance, if you wanted to assign let a group create users in an ID provider, you could grant the group permissions on the ID provider page, assuming you have the necessary permissions to do so.

.ID provider permissions input element
image::iam-assign-permissions.png["A permissions form element for an ID provider. There is a dropdown open for a custom group, which asks which permissions to grant. The options are 'read', 'create users' 'write users', 'id provider manager', and 'administrator'."]

== ID providers

The last piece of the IAM puzzle is ID providers. ID providers are what allows your users to log and authenticate. ID providers is also how you _create_ users in XP.

ID providers consist of:

- a unique name
- an ID provider application that controls how authentication works
- permissions that control who can manage the ID provider

That's right. ID providers wrap ID provider applications, which are also usually referred to only as _ID providers_. That can get a bit confusing, but I'm sure you can get through it.

We have two _separate_ forms of ID providers: _ID provider applications_ (often just referred to as _ID providers_), which provide the logic and mechanisms to authenticate, and the _ID providers_ you create in the Users application. The ID providers you create _use_ ID provider applications for their logic, but also add their own configuration via their names and permissions. That way, you can have multiple ID providers that use the same authentication logic (the ID provider application).

ID providers are hooked up to sites or applications via https://developer.enonic.com/docs/xp/stable/deployment/vhosts[virtual hosts] and control access to certain URLs. You can use separate ID providers for separate paths.

== Task: restrict admin access


When creating an ID provider, you need to specify who can modify it (you do this via the permissions). By default, it ships with the following permission set:

Authenticated (`/roles/system.authenticated`):: Read
Administrator (`/roles/system.admin`):: Administrator
Users Administrator (`/roles/system.user.admin`):: Administrator

üëÜÔ∏èWhat does 'read' mean here?:: A permission of 'read' means that any user who is logged in (and thus fulfills the "authenticated" requirement) can _see_ and open the info on this ID provider. However, if they try and save any edits they make to the page, they will not be saved.


Use the simple ID provider to restrict access to /admin.

NOTE: To be able to log in, you *need* at least the "Administration Console Login" (/roles/system.admin.login) role *OR* the "Administrator" (/roles/system.admin) role. This _is_ mentioned in the IAM docs, but is not made very obvious to the user.

Steps:

. Install Simple ID Provider from the [Enonic Market]
. Navigate to the "Users" entry in the admin panel
. Create a new ID provider at the root level
. Create a user that goes along with this
. Add this entry to your vhost config:
+
[source,properties,{subs}]
----
mapping.admin.host = {host}
mapping.admin.source = /
mapping.admin.target = /admin
mapping.admin.idProvider.simple = default
----
. Navigate to {host}:8080 and  log in.
